<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>

    <style>
        body { font-family: Arial; padding: 20px; background: #f4f4f4; }
        h1 { color: #333; }
        input, button { padding: 10px; margin: 5px; }
        ul { list-style: none; padding: 0; }
        li {
            background: #fff; padding: 10px; margin: 5px 0;
            display: flex; justify-content: space-between;
            align-items: center; border: 1px solid #ccc; border-radius: 5px;
        }
        .done { text-decoration: line-through; color: gray; }
        .task-text { flex: 1; margin: 0 10px; }
    </style>
</head>

<body>
    <h1>Todo App</h1>

    <input id="taskInput" type="text" placeholder="Enter task">
    <button onclick="addTodo()">Add Task</button>

    <ul id="taskList"></ul>

    <script>
        const taskList = document.getElementById("taskList");

        window.onload = fetchTodos;

        async function fetchTodos() {
            const res = await fetch("/todos");
            const todos = await res.json();
            renderTodos(todos);
        }

        function renderTodos(todos) {
            taskList.innerHTML = "";

            todos.forEach(todo => {
                const li = document.createElement("li");

                // Checkbox
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.checked = todo.isDone;
                checkbox.onchange = () => toggleTodo(todo._id, checkbox.checked);

                // Task text
                const taskText = document.createElement("span");
                taskText.className = "task-text";
                taskText.textContent = todo.task;
                if (todo.isDone) taskText.classList.add("done");

                // Edit button
                const editBtn = document.createElement("button");
                editBtn.textContent = "Edit";
                editBtn.onclick = () => editTodo(todo._id, taskText);

                // Delete button
                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "Delete";
                deleteBtn.onclick = () => deleteTodo(todo._id);

                li.append(checkbox, taskText, editBtn, deleteBtn);
                taskList.appendChild(li);
            });
        }

        // Add Todo
        async function addTodo() {
            const task = document.getElementById("taskInput").value;
            if (!task.trim()) return alert("Task cannot be empty");

            await fetch("/add-todo", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ task })
            });

            document.getElementById("taskInput").value = "";
            fetchTodos();
        }

        // Delete Todo
        async function deleteTodo(id) {
            await fetch(`/delete-todo/${_id}`, { method: "DELETE" });
            fetchTodos();
        }

        // Edit Todo
        async function editTodo(id, textElement) {
            const newText = prompt("Edit Task:", textElement.textContent);
            if (!newText || newText.trim() === "") return;

            await fetch(`/update-todo/${_id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ task: newText })
            });

            fetchTodos();
        }

        // Toggle completed
        async function toggleTodo(id, isDone) {
            await fetch(`/update-todo/${_id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ isDone })
            });

            fetchTodos();
        }
    </script>
</body>
</html>
